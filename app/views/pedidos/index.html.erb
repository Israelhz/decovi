<div class="divide80"></div>

<p id="notice"><%= notice %></p>

<h1>Pedidos</h1>


<table class="table table-hover">
    <thead>
        <tr>
            <th>#</th>
            <% if current_user.admin? %>
                <th>Cliente</th>
            <% end %>
            <th>Tipo</th>
            <th>Estatus</th>
            <th>Productos</th>
            <% if current_user.admin? %>
                <th colspan="6"></th>
            <% else %>
                <th colspan="4"></th>
            <% end %>
        </tr>
    </thead>

    <tbody>
    <% if current_user.admin? %>
        <% @pedidosAll.each do |pedido| %>
          <tr>
            <td><%= pedido.id %></td>
            <td><%= User.find(pedido.user_id).nombre%></td>
            <td><%= pedido.tipo %></td>
            <td>
            <%= pedido.estatus %>
            <% if pedido.estatus == 'Recibido' %>
              <br><%= button_to "Aprobar", { :controller => "pedidos", :action => "aprobar" }, :method => :get, params: { pedido_id: pedido.id } %>
            <% end %>
            </td>
            <td>
              <% pedido.product_orders.each do |producto| %>
                <%= producto.cantidad.to_s + ' ' + Producto.find(producto.producto_id).nombre + ' ' + Producto.find(producto.producto_id).acabado %> <br>
              <% end %>
            </td>
            <% if !Factura.where(pedido_id: pedido.id).exists? %>
                <td><%= link_to "Agregar Factura", new_factura_path(:pedido => pedido) %></td>
            <% end %>
            <td><%= link_to "Agregar Productos", product_orders_path(:pedido => pedido) %></td>
            <td><%= link_to 'Ver', pedido %></td>
            <td><%= link_to 'Editar', edit_pedido_path(pedido) %></td>
            <td><%= link_to 'Borrar', pedido, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
    <% else %>
        <% @pedidos.each do |pedido| %>
          <tr>
            <td><%= pedido.id %></td>
            <td><%= pedido.tipo %></td>
            <td>
            <%= pedido.estatus %>
            </td>
            <td>
              <% pedido.product_orders.each do |producto| %>
                <%= producto.cantidad.to_s + ' ' + Producto.find(producto.producto_id).nombre + ' ' + Producto.find(producto.producto_id).acabado %> <br>
              <% end %>
            </td>
            <td><%= link_to "Agregar Productos", product_orders_path(:pedido => pedido) %></td>
            <td><%= link_to 'Ver', pedido %></td>
            <td><%= link_to 'Editar', edit_pedido_path(pedido) %></td>
            <td><%= link_to 'Borrar', pedido, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
        <% end %>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'Nuevo Pedido', new_pedido_path, class:'btn btn-primary' %>

<div class="divide40"></div>